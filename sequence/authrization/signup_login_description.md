## 필수 정보

### 1. 참여자 (Participants/Actors)
| 참여자 | 설명 | 기술 스택 |
|--------|------|-----------|
| 사용자 (User) | 서비스 이용자 | 브라우저 |
| 프론트엔드 (Frontend) | 웹 클라이언트 | Next.js + Nginx |
| 백엔드 (Backend) | API 서버 | Spring + Spring Security |
| DB (Database) | 데이터 저장소 | - |

### 2. 시나리오/흐름 설명
- 사용자 회원가입 프로세스
- 로그인 및 JWT 인증 프로세스
- 로그아웃 프로세스

### 3. 메시지 흐름 순서

#### 3-1. 회원가입 흐름
```
1. 사용자 → 프론트엔드: 회원가입 폼 제출 (이메일, 비밀번호, 기타 정보)
2. 프론트엔드 → 백엔드: 회원가입 API 요청 (POST /api/auth/signup)
3. 백엔드 → DB: 이메일 중복 확인 조회
4. DB → 백엔드: 조회 결과 반환
5. [조건] 회원가입 성공 시:
   - 백엔드 → DB: 사용자 정보 저장 (비밀번호는 BCrypt 암호화)
   - DB → 백엔드: 저장 완료
   - 백엔드 → 프론트엔드: 회원가입 성공 응답
   - 프론트엔드 → 사용자: 회원가입 성공, 로그인 페이지로 이동
6. [조건] 회원가입 실패 시:
   - 백엔드 → 프론트엔드: 에러 응답 (중복 이메일, 유효성 검증 실패 등)
   - 프론트엔드 → 사용자: 에러 메시지 표시
```

#### 3-2. 로그인 흐름
```
1. 사용자 → 프론트엔드: 로그인 폼 제출 (이메일, 비밀번호)
2. 프론트엔드 → 백엔드: 로그인 API 요청 (POST /api/auth/login)
3. 백엔드 → DB: 사용자 조회 (이메일로 검색)
4. DB → 백엔드: 사용자 정보 반환
5. 백엔드: 비밀번호 검증 (BCrypt 매칭)
6. [조건] 인증 성공 시:
   - 백엔드: Access Token 생성 (JWT)
   - 백엔드: Refresh Token 생성 (JWT)
   - 백엔드 → DB: Refresh Token 저장
   - DB → 백엔드: 저장 완료
   - 백엔드 → 프론트엔드: 로그인 성공 응답 (토큰을 Cookie에 설정)
   - 프론트엔드 → 사용자: 로그인 성공, 홈화면로 이동
7. [조건] 인증 실패 시:
   - 백엔드 → 프론트엔드: 에러 응답 (401 Unauthorized)
   - 프론트엔드 → 사용자: 로그인 실패, 홈화면으로 이동, 에러 메시지 표시
```

#### 3-3. 토큰 갱신 흐름 (Access Token 만료 시)
```
1. 사용자 → 프론트엔드: API 요청
2. 프론트엔드 → 백엔드: API 요청 (만료된 Access Token)
3. 백엔드 → 프론트엔드: 401 Unauthorized (토큰 만료)
4. 프론트엔드 → 백엔드: 토큰 갱신 요청 (POST /api/auth/refresh, Refresh Token)
5. 백엔드 → DB: Refresh Token 유효성 확인
6. DB → 백엔드: Refresh Token 정보 반환
7. [조건] Refresh Token 유효 시:
   - 백엔드: 새 Access Token 생성
   - 백엔드 → 프론트엔드: 새 Access Token 응답 (Cookie에 설정)
   - 프론트엔드 → 백엔드: 원래 API 재요청 (새 Access Token)
   - 백엔드 → 프론트엔드: API 응답
   - 프론트엔드 → 사용자: 결과 표시
8. [조건] Refresh Token 무효 시:
   - 백엔드 → 프론트엔드: 에러 응답 (401 Unauthorized)
   - 프론트엔드 → 사용자: 로그인 페이지로 이동
```

#### 3-4. 로그아웃 흐름
```
1. 사용자 → 프론트엔드: 로그아웃 버튼 클릭
2. 프론트엔드 → 백엔드: 로그아웃 API 요청 (POST /api/auth/logout)
3. 백엔드 → DB: Refresh Token 삭제
4. DB → 백엔드: 삭제 완료
5. 백엔드 → 프론트엔드: 로그아웃 성공 응답 (Cookie 삭제 지시)
6. 프론트엔드: Cookie에서 토큰 삭제
7. 프론트엔드 → 사용자: 로그아웃 완료, 홈화면으로 이동
```

---

## 선택 정보 (더 정교한 다이어그램을 위해)

### 4. 조건부 흐름 (alt/opt)
| 시나리오 | 분기 조건 |
|----------|-----------|
| 회원가입 | 성공 / 실패 |
| 로그인 | 성공 / 실패 |
| 토큰 갱신 | Refresh Token 유효 / 무효 |
| 로그아웃 | 없음 (단일 흐름) |

### 5. 반복 (loop)
- 없음

### 6. 병렬 처리 (par)
- 없음

### 7. 비동기 호출
- 모두 동기 호출

### 8. 노트/주석
- 없음

---

## 추가 기술 정보

### 인증/인가 방식
| 항목 | 설명 |
|------|------|
| 인증 방식 | JWT (JSON Web Token) |
| 토큰 종류 | Access Token + Refresh Token |
| 비밀번호 암호화 | BCrypt (Spring Security 기본) |
| 토큰 저장 위치 (클라이언트) | Cookie |
| Refresh Token 저장 위치 (서버) | Database |

### 보안 정책
| 항목 | 설명 |
|------|------|
| 로그인 시도 제한 | 없음 |
| 이메일 인증 | 미사용 |
| 소셜 로그인 | 추후 도입 예정 (현재 미포함) |

### 통신 방식
| 항목 | 설명 |
|------|------|
| 프론트엔드 ↔ 백엔드 | 클라이언트에서 직접 API 호출 |
| 호출 방식 | 동기 (Synchronous) |