# 수료증 OCR 다단계 강의명 매칭 검증 - PRD

## 문서 정보

| 항목 | 내용 |
|------|------|
| 작성일 | 2025-12-27 |
| 상태 | Draft |
| 버전 | 0.1 |

---

## 1. 개요

### 1.1 배경

수료증 OCR 검증 시 강의명 매칭에서 유사 문자 불일치 문제가 발생하고 있다.

**현재 문제**:
- DB 강의명: `[구름 x 인프런] 자바 스프링...` (키보드 입력, 알파벳 x)
- OCR 결과: `[구름 × 인프런] 자바 스프링...` (수료증 인쇄물, 곱셈 기호 ×)

동일한 강의임에도 문자 인코딩 차이로 인해 매칭 실패가 발생한다.

### 1.2 목적

- **진짜 수료증이 거부되는 문제(False Negative) 해결**
- 다단계 매칭으로 유연하면서도 명백한 스팸은 차단
- 관리자 최종 승인 전제하에 관대한 검증 정책 적용

### 1.3 범위

**포함**:
- 다단계 강의명 매칭 로직 구현 (4단계: 0~3차)
- OCR 결과 유효성 검사 (0단계)
- 유사 문자 정규화 (Homoglyph Normalization)
- 문자열 유사도 검사 (Jaro-Winkler)
- 매칭 단계별 로깅

**제외**:
- OCR 엔진 변경
- 관리자 승인 프로세스 변경
- 프론트엔드 변경

---

## 2. 사용자 스토리

### 2.1 주요 사용자

| 사용자 | 역할 | 설명 |
|--------|------|------|
| USER | 일반 사용자 | 수료증을 업로드하여 인증하는 사용자 |
| ADMIN | 관리자 | 수료증 인증 요청을 최종 승인/거부하는 관리자 |

### 2.2 사용자 스토리

#### US-1: 수료증 인증
- **사용자**: USER
- **행동**: 수료증 이미지를 업로드하여 강의 수료를 인증한다
- **목적**: 해당 강의에 대한 후기 작성 권한을 얻기 위해

#### US-2: 유사 문자 포함 수료증 인증
- **사용자**: USER
- **행동**: 특수 문자(×, —, ' 등)가 포함된 수료증을 업로드한다
- **목적**: DB에 저장된 강의명과 약간 다르더라도 정상적으로 인증되기 위해

---

## 3. 기능 요구사항

### 3.1 필수 기능 (Must Have)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| FR-0 | 0단계 OCR 유효성 검사 | OCR 결과가 없거나 너무 짧으면 즉시 실패 처리 | P0 |
| FR-1 | 1차 정확한 매칭 | OCR 텍스트에 강의명이 정확히 포함되어 있는지 확인 | P0 |
| FR-2 | 2차 유사 문자 정규화 매칭 | ×→x, —→-, '→' 등 유사 문자 변환 후 매칭 | P0 |
| FR-3 | 3차 유사도 매칭 | Jaro-Winkler 유사도 80% 이상이면 통과 | P0 |
| FR-4 | 단계별 로깅 | 각 매칭 단계와 결과를 로그로 기록 | P0 |

### 3.2 선택 기능 (Nice to Have)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| FR-N1 | 매칭 단계 메타데이터 저장 | 어떤 단계에서 매칭되었는지 DB에 기록 | P2 |

---

## 4. 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| 성능 | 매칭 로직은 100ms 이내 완료 |
| 보안 | 유사도 임계값을 너무 낮추면 다른 강의 수료증으로 통과 가능 → 80% 유지 |
| 확장성 | 새로운 유사 문자 발견 시 쉽게 추가 가능한 구조 |

---

## 5. 매칭 알고리즘 상세

### 5.1 다단계 매칭 흐름

```
[0단계] OCR 결과 유효성 검사
  ├─ 텍스트 없음 → 즉시 실패 (종료)
  ├─ 텍스트 길이 < 강의명의 50% → 즉시 실패 (종료)
  └─ 유효 ↓

[1차] 정확한 매칭
  ├─ 통과 → 성공 (종료)
  └─ 실패 ↓

[2차] 유사 문자 정규화 후 매칭
  ├─ 통과 → 성공 (종료)
  └─ 실패 ↓

[3차] 유사도 검사 (Jaro-Winkler ≥ 0.8)
  ├─ 통과 → 성공 (종료)
  └─ 실패 → 최종 실패
```

### 5.2 0단계: OCR 결과 유효성 검사

명백히 수료증이 아닌 이미지(고양이 사진, 빈 이미지 등)를 조기에 필터링한다.

| 조건 | 동작 | 이유 |
|------|------|------|
| OCR 결과가 null 또는 빈 리스트 | 즉시 실패 | 이미지에서 텍스트 추출 불가 |
| OCR 텍스트 길이 < 강의명 길이의 50% | 즉시 실패 | 강의명이 포함될 수 없음 |

### 5.3 유사 문자 정규화 대상

| 원본 문자 | 변환 | 설명 |
|-----------|------|------|
| × (U+00D7) | x | 곱셈 기호 → 알파벳 x |
| — (U+2014) | - | em dash → hyphen |
| – (U+2013) | - | en dash → hyphen |
| ' (U+2018) | ' | 왼쪽 작은따옴표 |
| ' (U+2019) | ' | 오른쪽 작은따옴표 |
| " (U+201C) | " | 왼쪽 큰따옴표 |
| " (U+201D) | " | 오른쪽 큰따옴표 |

### 5.4 유사도 알고리즘

**Jaro-Winkler 선택 이유**:
- 문자열 앞부분 일치에 가중치 부여 (강의명 앞부분이 중요)
- 0~1 범위로 직관적인 해석
- Apache Commons Text 라이브러리에 구현체 존재

**임계값**: 0.8 (80%) - 하드코딩

---

## 6. 제약사항 및 가정

### 6.1 제약사항

- 유사도 임계값(80%)은 코드에 하드코딩
- 3차 매칭까지 실패 시 검증 실패 처리

### 6.2 가정

- 관리자가 최종 승인을 수행하므로 False Positive는 관리자가 필터링
- False Negative(진짜 수료증 거부)가 더 심각한 문제로 간주

---

## 7. 용어 정의

| 용어 | 정의 |
|------|------|
| Homoglyph | 시각적으로 유사하지만 다른 유니코드를 가진 문자 |
| Jaro-Winkler | 두 문자열 간 유사도를 0~1로 측정하는 알고리즘 |
| False Positive | 잘못된 수료증이 통과되는 경우 |
| False Negative | 올바른 수료증이 거부되는 경우 |

---

## 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 0.1 | 2025-12-27 | 초안 작성 |
| 0.2 | 2025-12-27 | 0단계 OCR 유효성 검사 추가 |
