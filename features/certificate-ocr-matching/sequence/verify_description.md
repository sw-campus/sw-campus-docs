# 수료증 검증 - 시퀀스 설명

## 개요

사용자가 수료증 이미지를 업로드하면 OCR로 텍스트를 추출하고, 다단계 매칭 알고리즘을 통해 강의명 일치 여부를 검증한다.

## 참여자 (Actors)

| Actor | 설명 |
|-------|------|
| Client | 프론트엔드 (웹) |
| Server | 백엔드 API 서버 |
| OCR | OCR 서버 (FastAPI) |
| S3 | AWS S3 스토리지 |
| DB | PostgreSQL 데이터베이스 |

## 흐름 설명

### 1. 수료증 이미지 업로드
- 사용자가 수료증 이미지를 선택하여 업로드
- Client가 `POST /api/v1/certificates/verify` API 호출

### 2. 중복 인증 확인
- Server가 해당 회원이 해당 강의에 대해 이미 인증했는지 확인
- 이미 인증된 경우 에러 반환

### 3. 강의 정보 조회
- Server가 DB에서 강의 정보(강의명) 조회

### 4. OCR 텍스트 추출
- Server가 OCR 서버에 이미지 전송
- OCR 서버가 PaddleOCR로 텍스트 추출 후 반환

### 5. 다단계 매칭 검증

#### 5.1 [0단계] OCR 유효성 검사
- OCR 결과가 없거나 텍스트 길이가 강의명의 50% 미만이면 즉시 실패

#### 5.2 [1차] 정확한 매칭
- OCR 텍스트에 강의명이 그대로 포함되어 있는지 확인
- 통과 시 성공 처리

#### 5.3 [2차] 유사 문자 정규화 매칭
- 양쪽 텍스트에서 유사 문자(×→x, —→- 등) 정규화
- 정규화된 텍스트로 포함 여부 확인
- 통과 시 성공 처리

#### 5.4 [3차] 유사도 매칭
- Jaro-Winkler 알고리즘으로 유사도 계산
- 80% 이상이면 통과

### 6. 수료증 저장 (매칭 성공 시)
- S3 Private Bucket에 이미지 업로드
- DB에 수료증 정보 저장 (status: "SUCCESS")

### 7. 응답 반환
- 성공/실패 결과를 Client에 반환

## 예외 처리

| 조건 | 처리 |
|------|------|
| 이미 인증된 수료증 | 409 Conflict - "이미 인증된 수료증입니다" |
| 강의를 찾을 수 없음 | 404 Not Found - "강의를 찾을 수 없습니다" |
| OCR 결과 없음 (0단계 실패) | 400 Bad Request - "수료증에서 텍스트를 추출할 수 없습니다" |
| 강의명 불일치 (1~3차 모두 실패) | 400 Bad Request - "해당 강의의 수료증이 아닙니다" |

## 관련 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/v1/certificates/verify | 수료증 검증 및 인증 |
