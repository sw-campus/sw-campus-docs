## 필수 정보

### 1. 참여자 (Participants/Actors)
| 참여자 | 설명 | 기술 스택 |
|--------|------|-----------|
| 사용자 (User) | 서비스 이용자 | 브라우저 |
| 프론트엔드 (Frontend) | 웹 클라이언트 | Next.js + Nginx |
| 백엔드 (Backend) | API 서버 | Spring + Spring Security |
| Gemini API | AI 추천 서비스 | Google Gemini API |
| DB (Database) | 데이터 저장소 | - |

### 2. 시나리오/흐름 설명
- 비교 페이지 접속 및 스크랩 목록 조회 프로세스
- 비교 강의 선택 프로세스 (카테고리 필터링)
- AI 비교 요청 프로세스 (설문조사 확인 포함)

### 3. 메시지 흐름 순서

#### 3-1. 비교 페이지 접속 흐름
```
1. 사용자 → 프론트엔드: 비교하기 페이지 접속
2. 프론트엔드 → 백엔드: 스크랩 목록 조회 API 요청 (GET /api/wishlists)
3. 백엔드 → DB: 스크랩 목록 조회 (userId)
4. DB → 백엔드: 스크랩 목록 반환 (강의 정보 + 카테고리 포함)
5. 백엔드 → 프론트엔드: 200 OK (스크랩 목록 데이터)
6. 프론트엔드 → 사용자: 스크랩 목록 표시 (비교 강의 선택 UI)
```

#### 3-2. 비교 강의 선택 흐름
```
1. 사용자 → 프론트엔드: 첫 번째 강의 선택
2. 프론트엔드: 선택된 강의의 카테고리 확인
3. 프론트엔드 → 사용자: 같은 카테고리 강의만 두 번째 선택 가능하도록 필터링
4. 사용자 → 프론트엔드: 두 번째 강의 선택 (같은 카테고리)
5. 프론트엔드 → 사용자: 선택된 2개 강의의 상세 정보 나열 (비교 테이블)
```

#### 3-3. AI 비교 요청 흐름
```
1. 사용자 → 프론트엔드: "AI 비교하기" 버튼 클릭
2. 프론트엔드 → 백엔드: 사용자 설문조사 정보 조회 (GET /api/users/information)
3. 백엔드 → DB: Information 테이블 조회 (userId)
4. DB → 백엔드: 설문조사 정보 반환
5. [조건] 설문조사 미작성 (Information 없음):
   - 백엔드 → 프론트엔드: 404 Not Found (설문조사 정보 없음)
   - 프론트엔드 → 사용자: 설문조사 페이지로 리다이렉트
6. [조건] 설문조사 작성됨 (Information 있음):
   - 백엔드 → 프론트엔드: 200 OK (설문조사 정보)
   - 프론트엔드: AI 프롬프트 구성 (비교 강의 정보 + 사용자 정보)
   - 프론트엔드 → Gemini API: AI 비교 요청 (POST)
   - Gemini API → 프론트엔드: AI 응답 반환 (3개 섹션 포함)
   - 프론트엔드: AI 응답 파싱 (3개 섹션으로 분리)
   - 프론트엔드 → 사용자: AI 비교 결과 표시 (3개 말풍선)
```

---

## 선택 정보 (더 정교한 다이어그램을 위해)

### 4. 조건부 흐름 (alt/opt)
| 시나리오 | 분기 조건 |
|----------|-----------|
| AI 비교 요청 | 설문조사 작성됨 / 설문조사 미작성 |
| 두 번째 강의 선택 | 같은 카테고리 강의 존재 / 없음 (UI 레벨) |

### 5. 반복 (loop)
- 없음

### 6. 병렬 처리 (par)
- 없음

### 7. 비동기 호출
- Gemini API 호출은 비동기 (프론트엔드에서 await 처리)

### 8. 노트/주석
- 비교는 같은 카테고리 강의만 가능
- AI 호출은 프론트엔드에서 직접 Gemini API로 요청
- AI 응답은 1회 호출 → 3개 섹션 파싱 → 3개 말풍선 표시
- 설문조사 미작성 시 설문조사 페이지로 리다이렉트

---

## 추가 기술 정보

### 인증/인가 방식
| 항목 | 설명 |
|------|------|
| 비교 페이지 접속 | 로그인 필수 |
| AI 비교 요청 | 로그인 필수 + 설문조사 작성 필수 |

### 데이터 관계
| 관계 | 설명 |
|------|------|
| User : Information | 1 : 1 (유저당 1개 설문조사 정보) |
| User : Wishlist | 1 : N (유저당 여러 스크랩) |
| Lecture : Category | N : 1 (강의는 1개 카테고리에 속함) |

### Information (설문조사) 테이블
| 필드 | 설명 |
|------|------|
| userId | 사용자 ID (FK) |
| interests | 관심 분야 |
| career | 경력 |
| education | 학력 |
| (추가 필드) | 추후 확장 가능 |
| createdAt | 작성 일시 |
| updatedAt | 수정 일시 |

### AI 프롬프트 구성 요소
| 항목 | 설명 |
|------|------|
| 강의 A 정보 | 강의명, 카테고리, 가격, 평점, 커리큘럼 등 |
| 강의 B 정보 | 강의명, 카테고리, 가격, 평점, 커리큘럼 등 |
| 사용자 정보 | 관심 분야, 경력, 학력 등 (Information 테이블) |

### AI 응답 형식
| 항목 | 설명 |
|------|------|
| 호출 방식 | 1회 호출 |
| 응답 형식 | 3개 섹션 (구분자로 파싱) |
| 표시 방식 | 3개 말풍선 |

#### AI 프롬프트 예시
```
사용자 정보:
- 관심 분야: {interests}
- 경력: {career}
- 학력: {education}

비교 강의:
- 강의 A: {lectureA 정보}
- 강의 B: {lectureB 정보}

다음 형식으로 3가지 관점에서 비교 분석해주세요:
[비교1] 사용자 상황에 맞는 추천
[비교2] 강의 특징 비교
[비교3] 최종 추천 및 조언
```

### API 엔드포인트
| 기능 | Method | Endpoint | 설명 |
|------|--------|----------|------|
| 스크랩 목록 조회 | GET | /api/wishlists | 로그인 사용자의 스크랩 목록 (카테고리 포함) |
| 설문조사 정보 조회 | GET | /api/users/information | 로그인 사용자의 설문조사 정보 |
| AI 비교 요청 | POST | Gemini API (외부) | 프론트엔드에서 직접 호출 |

### Gemini API 정보
| 항목 | 설명 |
|------|------|
| 모델명 | gemini-2.5-flash-preview-09-2025 |
| URL | https://generativelanguage.googleapis.com/v1beta/models/{MODEL_NAME}:generateContent |
| 호출 주체 | 프론트엔드 (Next.js) |

### 에러 케이스
| HTTP Status | 설명 | 발생 조건 |
|-------------|------|-----------|
| 401 Unauthorized | 인증 필요 | 비로그인 상태에서 접근 |
| 404 Not Found | 설문조사 없음 | Information 테이블에 데이터 없음 |
| 500 Internal Server Error | AI 호출 실패 | Gemini API 오류 |

### 프론트엔드 상태 관리
| 상태 | 설명 |
|------|------|
| selectedLecture1 | 첫 번째 선택된 강의 |
| selectedLecture2 | 두 번째 선택된 강의 |
| filteredLectures | 같은 카테고리로 필터링된 강의 목록 |
| aiResponse | AI 응답 (3개 섹션) |
| isLoading | AI 호출 중 로딩 상태 |
