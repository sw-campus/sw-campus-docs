# 설문조사 시퀀스 설명

## 필수 정보

### 1. 참여자 (Participants/Actors)

| 참여자 | 설명 | 기술 스택 |
|--------|------|-----------|
| 사용자 (User) | 서비스 이용자 (USER Role) | 브라우저 |
| 관리자 (Admin) | 시스템 관리자 (ADMIN Role) | 브라우저 |
| 프론트엔드 (Frontend) | 웹 클라이언트 | Next.js |
| 백엔드 (Backend) | API 서버 | Spring + Spring Security |
| DB (Database) | 데이터 저장소 | PostgreSQL |

### 2. 시나리오/흐름 설명

- 설문조사 작성 프로세스
- 설문조사 조회 프로세스 (본인)
- 설문조사 수정 프로세스
- 관리자 설문조사 목록 조회 프로세스
- 관리자 특정 사용자 설문조사 조회 프로세스

### 3. 메시지 흐름 순서

#### 3-1. 설문조사 작성 흐름

```
1. 사용자 → 프론트엔드: 설문조사 페이지 접근
2. 프론트엔드 → 백엔드: 기존 설문조사 조회 (GET /api/v1/members/me/survey)
3. 백엔드 → DB: 설문조사 조회 (user_id)
4. DB → 백엔드: 조회 결과 반환

5. [조건] 설문조사 없음 (404):
   - 프론트엔드 → 사용자: 빈 설문조사 폼 표시
   - 사용자 → 프론트엔드: 설문 항목 입력 후 제출
   - 프론트엔드 → 백엔드: 설문조사 작성 요청 (POST /api/v1/members/me/survey)
   - 백엔드 → DB: 설문조사 저장
   - DB → 백엔드: 저장 완료
   - 백엔드 → 프론트엔드: 201 Created + 설문 데이터
   - 프론트엔드 → 사용자: 작성 완료 메시지

6. [조건] 설문조사 존재 (200):
   - 프론트엔드 → 사용자: 기존 설문 데이터로 폼 표시 (수정 모드)
```

#### 3-2. 설문조사 조회 흐름 (본인)

```
1. 사용자 → 프론트엔드: 마이페이지 > 설문조사 메뉴 클릭
2. 프론트엔드 → 백엔드: 본인 설문조사 조회 (GET /api/v1/members/me/survey)
3. 백엔드: JWT에서 userId 추출
4. 백엔드 → DB: 설문조사 조회 (user_id)
5. DB → 백엔드: 조회 결과 반환

6. [조건] 설문조사 존재:
   - 백엔드 → 프론트엔드: 200 OK + 설문 데이터
   - 프론트엔드 → 사용자: 설문 내용 표시

7. [조건] 설문조사 없음:
   - 백엔드 → 프론트엔드: 404 Not Found
   - 프론트엔드 → 사용자: "설문조사를 작성해주세요" 안내
```

#### 3-3. 설문조사 수정 흐름

```
1. 사용자 → 프론트엔드: 설문조사 수정 버튼 클릭
2. 프론트엔드 → 사용자: 수정 가능한 폼 표시 (기존 데이터 로드)
3. 사용자 → 프론트엔드: 항목 수정 후 저장 버튼 클릭
4. 프론트엔드 → 백엔드: 설문조사 수정 요청 (PUT /api/v1/members/me/survey)
5. 백엔드: JWT에서 userId 추출
6. 백엔드 → DB: 설문조사 존재 여부 확인
7. DB → 백엔드: 조회 결과 반환

8. [조건] 설문조사 존재:
   - 백엔드 → DB: 설문조사 업데이트
   - DB → 백엔드: 업데이트 완료
   - 백엔드 → 프론트엔드: 200 OK + 수정된 설문 데이터
   - 프론트엔드 → 사용자: 수정 완료 메시지

9. [조건] 설문조사 없음:
   - 백엔드 → 프론트엔드: 404 Not Found
   - 프론트엔드 → 사용자: 에러 메시지 표시
```

#### 3-4. 관리자 설문조사 목록 조회 흐름

```
1. 관리자 → 프론트엔드: 관리자 페이지 > 설문조사 관리 메뉴 클릭
2. 프론트엔드 → 백엔드: 전체 설문조사 목록 조회 (GET /api/v1/admin/members/surveys)
3. 백엔드: JWT에서 Role 확인 (ADMIN 여부)

4. [조건] ADMIN Role:
   - 백엔드 → DB: 전체 설문조사 페이징 조회
   - DB → 백엔드: 설문조사 목록 반환
   - 백엔드 → 프론트엔드: 200 OK + 페이징된 설문 목록
   - 프론트엔드 → 관리자: 설문조사 목록 테이블 표시

5. [조건] ADMIN Role 아님:
   - 백엔드 → 프론트엔드: 403 Forbidden
   - 프론트엔드 → 관리자: 권한 없음 메시지
```

#### 3-5. 관리자 특정 사용자 설문조사 조회 흐름

```
1. 관리자 → 프론트엔드: 설문조사 목록에서 특정 사용자 클릭
2. 프론트엔드 → 백엔드: 특정 사용자 설문조사 조회 (GET /api/v1/admin/members/{userId}/survey)
3. 백엔드: JWT에서 Role 확인 (ADMIN 여부)

4. [조건] ADMIN Role:
   - 백엔드 → DB: 해당 사용자 설문조사 조회
   - DB → 백엔드: 조회 결과 반환
   
   - [조건] 설문조사 존재:
     - 백엔드 → 프론트엔드: 200 OK + 설문 데이터
     - 프론트엔드 → 관리자: 설문 상세 정보 표시
   
   - [조건] 설문조사 없음:
     - 백엔드 → 프론트엔드: 404 Not Found
     - 프론트엔드 → 관리자: "해당 사용자의 설문조사가 없습니다" 메시지

5. [조건] ADMIN Role 아님:
   - 백엔드 → 프론트엔드: 403 Forbidden
```

---

## 4. 데이터 흐름

### 4.1 설문조사 데이터 구조

```json
{
  "userId": 1,
  "major": "컴퓨터공학",
  "bootcampCompleted": true,
  "wantedJobs": "백엔드 개발자, 데이터 엔지니어",
  "licenses": "정보처리기사, SQLD, AWS SAA",
  "hasGovCard": true,
  "affordableAmount": 500000,
  "createdAt": "2025-12-12T10:00:00",
  "updatedAt": "2025-12-12T10:00:00"
}
```

### 4.2 LLM 추천 연동 (참고)

설문조사 데이터는 LLM 강의 추천 시 프롬프트에 포함됩니다:

```
1. 프론트엔드 → 백엔드: 본인 설문조사 조회 (GET /api/v1/members/me/survey)
2. 백엔드 → 프론트엔드: 설문 데이터 반환
3. 프론트엔드 → AI 서버: 설문 데이터 + 추천 요청 프롬프트 전송
4. AI 서버 → 프론트엔드: 추천 결과 반환
```

---

## 5. 에러 처리

| 상황 | HTTP Status | 에러 코드 | 사용자 안내 |
|------|-------------|----------|------------|
| 이미 설문 작성됨 | 409 | SURVEY001 | "이미 설문조사를 작성하셨습니다" |
| 설문조사 없음 | 404 | SURVEY002 | "설문조사를 찾을 수 없습니다" |
| 인증 필요 | 401 | COMMON001 | "로그인이 필요합니다" |
| 권한 없음 | 403 | COMMON002 | "접근 권한이 없습니다" |

---

## 6. 관련 문서

- [Tech Spec](../../features/survey/tech-spec.md)
- [PRD](../../features/survey/prd.md)
