# 후기 (Review) - PRD

> Product Requirements Document

## 문서 정보

| 항목 | 내용 |
|------|------|
| 작성일 | 2025-12-10 |
| 상태 | Draft |
| 버전 | 0.1 |

---

## 1. 배경 및 목적

### 1.1 배경

SW Campus는 소프트웨어 교육 강의를 비교하고 리뷰할 수 있는 플랫폼입니다. 사용자들이 실제 수강 경험을 바탕으로 강의에 대한 후기를 작성하고, 다른 사용자들이 이를 참고하여 강의 선택에 도움을 받을 수 있는 시스템이 필요합니다.

후기의 신뢰성을 확보하기 위해 **수료증 인증**을 통해 실제 수강생만 후기를 작성할 수 있도록 하며, **관리자 사후 검토**를 통해 부적절한 후기를 관리합니다.

### 1.2 목적

- 수료증 인증을 통한 신뢰성 있는 후기 시스템 구축
- 다양한 카테고리별 상세 평점으로 강의 품질 다각도 평가
- OCR 기반 수료증 자동 검증으로 인증 편의성 제공
- 관리자 사후 검토를 통한 후기 품질 관리

---

## 2. 사용자 정의

### 2.1 사용자 유형

| 사용자 유형 | Role | 설명 |
|------------|------|------|
| 일반 사용자 | `USER` | 수료증 인증 후 후기 작성/수정/삭제 |
| 관리자 | `ADMIN` | 후기 승인/반려, 블라인드 처리 |

### 2.2 후기 작성 자격

```
일반 사용자 (USER)
  → 로그인 필수
  → 수료증 인증 완료 필수
  → 강의당 1개 후기만 작성 가능
  → 닉네임 설정 필수 (미설정 시 설정 유도)
```

---

## 3. 기능 요구사항

### 3.1 수료증 인증

#### 3.1.1 인증 여부 확인

| 구분 | 사용자 스토리 |
|------|-------------|
| US-01 | 사용자는 후기 작성 버튼 클릭 시 해당 강의의 수료증 인증 여부를 확인받는다 |
| US-02 | 이미 수료증 인증된 강의는 바로 후기 작성 폼으로 이동한다 |

#### 3.1.2 수료증 인증 요청

| 구분 | 사용자 스토리 |
|------|-------------|
| US-03 | 수료증 미인증 시 수료증 인증 모달이 표시된다 |
| US-04 | 사용자는 수료증 이미지를 업로드하여 인증을 요청할 수 있다 |
| US-05 | 업로드된 수료증 이미지는 S3에 저장된다 |
| US-06 | OCR 서버를 통해 수료증 이미지에서 강의명을 추출한다 |
| US-07 | 추출된 강의명이 해당 강의와 일치하면 인증 성공 처리된다 |
| US-08 | 인증 실패 시 (OCR 실패/강의명 불일치) 에러 메시지가 표시되고 업로드된 이미지는 삭제된다 |

### 3.2 후기 작성

#### 3.2.1 작성 가능 여부 확인

| 구분 | 사용자 스토리 |
|------|-------------|
| US-09 | 사용자는 강의당 1개의 후기만 작성할 수 있다 |
| US-10 | 이미 후기를 작성한 강의에 재작성 시도 시 "이미 작성한 후기입니다" 메시지가 표시된다 |

#### 3.2.2 닉네임 확인

| 구분 | 사용자 스토리 |
|------|-------------|
| US-11 | 닉네임이 설정되지 않은 사용자는 후기 작성 전 닉네임 설정 페이지로 유도된다 |
| US-12 | JWT 토큰의 `hasNickname` 플래그를 통해 닉네임 설정 여부를 판단한다 |

#### 3.2.3 후기 내용 작성

| 구분 | 사용자 스토리 |
|------|-------------|
| US-13 | 사용자는 전체 별점(1~5점)을 입력할 수 있다 |
| US-14 | 사용자는 카테고리별 상세 별점을 입력할 수 있다 |
| US-15 | 사용자는 후기 내용(텍스트)을 입력할 수 있다 |
| US-16 | 후기 작성 완료 시 승인 대기(PENDING) 상태로 저장된다 |
| US-17 | 후기 작성 성공 시 강의 상세 페이지로 이동한다 |

### 3.3 후기 수정

| 구분 | 사용자 스토리 |
|------|-------------|
| US-18 | 사용자는 본인이 작성한 후기만 수정할 수 있다 |
| US-19 | 강의 상세 페이지 또는 마이페이지에서 수정 버튼을 클릭할 수 있다 |
| US-20 | 수정 폼에는 기존 작성 내용이 채워져 표시된다 |
| US-21 | 별점, 상세 별점, 후기 내용을 수정할 수 있다 |
| US-22 | **관리자가 승인(APPROVED)한 후기는 사용자가 수정할 수 없다** |
| US-23 | **PENDING 또는 REJECTED 상태의 후기만 사용자가 수정 가능하다** |

### 3.4 후기 삭제

> **Note**: 사용자는 후기를 삭제할 수 없습니다. 수정만 가능합니다.
> 데이터 보존을 위해 삭제 대신 블라인드(BLURRED) 처리 방식을 사용합니다.

### 3.5 관리자 후기 관리

#### 3.5.1 승인 대기 목록 조회

| 구분 | 사용자 스토리 |
|------|-------------|
| US-25 | 관리자는 승인 대기(PENDING) 상태의 후기 목록을 조회할 수 있다 |
| US-26 | 목록에는 작성자 정보, 강의 정보가 포함된다 |

#### 3.5.2 수료증 검증

| 구분 | 사용자 스토리 |
|------|-------------|
| US-27 | 관리자는 후기의 수료증 이미지를 조회할 수 있다 |
| US-28 | 수료증 이미지와 강의명을 비교하여 검증한다 |

#### 3.5.3 후기 승인/반려

| 구분 | 사용자 스토리 |
|------|-------------|
| US-29 | 관리자는 후기를 승인(APPROVED) 처리할 수 있다 |
| US-30 | 승인된 후기만 일반 사용자에게 노출된다 |
| US-31 | 관리자는 후기를 반려(삭제) 처리할 수 있다 |

#### 3.5.4 블라인드 처리

| 구분 | 사용자 스토리 |
|------|-------------|
| US-35 | 관리자는 후기를 블라인드 처리할 수 있다 |
| US-36 | 블라인드 처리된 후기는 목록에 표시되지만 비정상 상태로 표시된다 |
| US-37 | 관리자는 블라인드 처리를 해제할 수 있다 |

> **블라인드 vs 반려 차이**
> - **블라인드(blurred: true)**: 후기가 목록에 **표시됨** (UI 처리는 프론트엔드에서 결정)
> - **반려(REJECTED)**: 후기가 목록에 **아예 표시되지 않음** (미노출)

---

## 4. 상세 별점 카테고리

| 코드 | 카테고리명 | 설명 |
|------|----------|------|
| `TEACHER` | 강사진 | 강사의 전문성, 강의력 평가 |
| `CURRICULUM` | 커리큘럼(학습지원) | 교육 과정, 학습 자료 품질 |
| `MANAGEMENT` | 운영 및 학습환경 | 수업 운영, 학습 환경 |
| `FACILITY` | 취업지원 | 취업 연계, 취업 지원 서비스 |
| `PROJECT` | 프로젝트 | 프로젝트 경험, 포트폴리오 |

---

## 5. 후기 승인 상태

| 값 | 상태 | Enum | 설명 | 사용자 노출 |
|:--:|------|------|------|:----------:|
| `0` | 대기 | `PENDING` | 관리자 검토 대기 | ❌ 미노출 |
| `1` | 승인 | `APPROVED` | 승인 완료 | ✅ 노출 |
| `2` | 반려 | `REJECTED` | 승인 반려 | ❌ 미노출 (목록에 아예 안 보임) |

---

## 5-1. 수료증 승인 상태

| 값 | 상태 | Enum | 설명 |
|:--:|------|------|------|
| `0` | 대기 | `PENDING` | 관리자 검토 대기 |
| `1` | 승인 | `APPROVED` | 수료증 검증 완료 → 2단계 후기 검토로 진행 |
| `2` | 반려 | `REJECTED` | 수료증 검증 실패 → 반려 이메일 발송 (2단계 진행 안 함) |

---

## 5-2. 블라인드 상태

| 값 | 상태 | 설명 | 사용자 노출 |
|:--:|------|------|:----------:|
| `false` | 정상 | 정상 표시 | 내용 전체 노출 |
| `true` | 블라인드 | 블라인드 처리 | 목록에 표시됨 (UI 처리는 프론트엔드) |

---

## 6. 비기능 요구사항

### 6.1 보안

| 구분 | 요구사항 |
|------|----------|
| NFR-01 | 후기 작성/수정/삭제는 로그인 필수 |
| NFR-02 | 후기 수정/삭제는 작성자 본인만 가능 |
| NFR-03 | 관리자 기능은 ADMIN 권한 필수 |
| NFR-04 | 수료증 이미지는 S3 Presigned URL로 접근 제어 |

### 6.2 성능

| 구분 | 요구사항 |
|------|----------|
| NFR-05 | 수료증 인증 응답 시간 5초 이내 (OCR 포함) |
| NFR-06 | 후기 작성 응답 시간 1초 이내 |

### 6.3 데이터 정합성

| 구분 | 요구사항 |
|------|----------|
| NFR-07 | 사용자당 강의별 1개 후기만 허용 (UNIQUE 제약) |
| NFR-08 | 전체 별점은 상세 별점의 평균으로 자동 계산 |

---

## 7. 범위 (Scope)

### 7.1 포함 (In Scope)

- [x] 수료증 인증 여부 확인
- [x] 수료증 이미지 업로드 및 S3 저장
- [x] OCR 기반 수료증 검증
- [x] 후기 작성 (전체 별점 + 상세 별점 + 내용)
- [x] 후기 수정
- [x] 관리자 승인 대기 목록 조회
- [x] 관리자 수료증 이미지 조회
- [x] 관리자 후기 승인/반려
- [x] 관리자 후기 블라인드 처리
- [x] JWT `hasNickname` 플래그 추가

### 7.2 제외 (Out of Scope)

- [ ] 후기 목록 조회 (강의 상세, 기관 상세 페이지에서 구현)
- [ ] 마이페이지 내 후기 목록 조회
- [ ] 사용자 후기 삭제 (수정만 가능)
- [ ] 후기 신고 기능
- [ ] 후기 좋아요/도움됐어요 기능

---

## 8. 데이터 요구사항

### 8.1 기존 테이블 활용

**REVIEWS 테이블**
| 컬럼 | 타입 | 설명 |
|------|------|------|
| REVIEW_ID | BIGINT | PK, AUTO INCREMENT |
| LECTURE_ID | BIGINT | FK → LECTURES |
| USER_ID | BIGINT | FK → MEMBERS |
| COMMENT | TEXT | 후기 내용 |
| SCORE | DECIMAL(2,1) | 전체 별점 (상세 별점 평균) |
| BLURRED | BOOLEAN | 블라인드 여부 (기본값: false) |
| CREATED_AT | TIMESTAMPTZ | 생성일시 |
| UPDATED_AT | TIMESTAMPTZ | 수정일시 |

> **추가 필요**: `APPROVAL_STATUS` 컬럼 (승인 상태)

**REVIEWS_DETAILS 테이블**
| 컬럼 | 타입 | 설명 |
|------|------|------|
| REVIEW_DETAIL_ID | BIGINT | PK, AUTO INCREMENT |
| REVIEW_ID | BIGINT | FK → REVIEWS |
| CATEGORY | VARCHAR(20) | 카테고리 코드 (TEACHER, CURRICULUM 등) |
| SCORE | DECIMAL(2,1) | 카테고리별 별점 |
| DETAIL_COMMENT | TEXT | 카테고리별 상세 코멘트 (선택) |

**CERTIFICATES 테이블**
| 컬럼 | 타입 | 설명 |
|------|------|------|
| CERTIFICATE_ID | BIGINT | PK, AUTO INCREMENT |
| USER_ID | BIGINT | FK → MEMBERS |
| LECTURE_ID | BIGINT | FK → LECTURES |
| STATUS | BOOLEAN | 인증 여부 |
| IMAGE_URL | TEXT | 수료증 이미지 S3 URL |

> **추가 필요**: `CREATED_AT` 컬럼 (인증 일시)

### 8.2 스키마 변경 사항

| 테이블 | 변경 내용 |
|--------|----------|
| REVIEWS | `APPROVAL_STATUS` 컬럼 추가 (SMALLINT, 기본값 0) |
| CERTIFICATES | `CREATED_AT` 컬럼 추가 (TIMESTAMPTZ) |

### 8.3 JWT 토큰 변경

| 항목 | 변경 내용 |
|------|----------|
| JWT Payload | `hasNickname` 플래그 추가 (Boolean) |

---

## 9. 데이터 관계

| 관계 | 설명 |
|------|------|
| User : Certificate | 1 : N (사용자당 여러 강의 수료증) |
| User : Review (per Lecture) | 1 : 1 (강의당 1개 후기) |
| Lecture : Review | 1 : N (강의당 여러 후기) |
| Review : ReviewDetail | 1 : N (후기당 5개 상세 별점) |

---

## 10. 관련 문서

- [Tech Spec](./tech-spec.md)
- [Sequence - Review](../../sequence/review/review_diagram.md)
- [Sequence - Admin Review Approval](../../sequence/review/admin_review_approval_diagram.md)
- [Development Plan](./plan/)
- [Implementation Report](./report/)

---

## 11. 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 0.1 | 2025-12-10 | 초안 작성 |
