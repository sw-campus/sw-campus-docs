# 인증 (Auth) - PRD

> Product Requirements Document

## 문서 정보

| 항목 | 내용 |
|------|------|
| 작성일 | 2025-12-05 |
| 상태 | Draft |
| 버전 | 0.1 |

---

## 1. 배경 및 목적

### 1.1 배경

SW Campus는 소프트웨어 교육 강의를 비교하고 리뷰할 수 있는 플랫폼입니다. 사용자가 서비스를 이용하기 위해서는 회원 인증 시스템이 필요하며, 일반 사용자/기관 담당자/관리자 각각의 역할에 맞는 접근 제어가 요구됩니다.

### 1.2 목적

- 안전한 회원가입 및 로그인 시스템 제공
- JWT 기반 인증으로 stateless한 API 서버 구현
- 역할(Role) 기반 접근 제어 기반 마련
- 소셜 로그인을 통한 사용자 편의성 향상

---

## 2. 사용자 정의

### 2.1 사용자 유형

| 사용자 유형 | Role | 설명 |
|------------|------|------|
| 일반 사용자 | `USER` | 강의 검색, 비교, 리뷰 작성 |
| 기관 담당자 | `ORGANIZATION` | 강의 등록 및 관리 (관리자 승인 필요) |
| 관리자 | `ADMIN` | 시스템 전체 관리, 기관 담당자 승인 |

### 2.2 사용자별 가입 절차

```
일반 사용자 (USER)
  → 회원가입 → 이메일 인증 → 완료

기관 담당자 (ORGANIZATION)
  → 회원가입 (재직증명서 첨부) → 이메일 인증 → Organization 생성 (PENDING) → 관리자 승인 (APPROVED)

관리자 (ADMIN)
  → 시스템에서 직접 생성 (회원가입 불가)
```

### 2.3 기관 승인 상태 (Organization.approvalStatus)

| 값 | 상태 | Enum | 설명 | 로그인 | 강의 등록 |
|:--:|------|------|------|:------:|:--------:|
| `0` | 대기 | `PENDING` | 승인 대기 | ✅ | ❌ |
| `1` | 승인 | `APPROVED` | 승인 완료 | ✅ | ✅ |
| `2` | 반려 | `REJECTED` | 승인 반려 | ✅ | ❌ |

> **Note**: 승인 상태는 Organization 테이블에서 관리 (TINYINT)
> **변경 사항**: 기존 Member.orgAuth → Organization.approvalStatus로 이동

---

## 3. 기능 요구사항

### 3.1 회원가입

#### 3.1.1 이메일 회원가입

| 구분 | 사용자 스토리 |
|------|-------------|
| US-01 | 사용자는 이메일, 비밀번호, 이름, 닉네임, 전화번호, 주소를 입력하여 회원가입할 수 있다 |
| US-02 | 사용자는 회원가입 시 이메일 인증을 완료해야 한다 |
| US-03 | 사용자는 중복된 이메일로 가입할 수 없다 |
| US-04 | 사용자는 비밀번호 정책(8자 이상, 특수문자 포함)을 준수해야 한다 |

#### 3.1.2 기관 담당자 회원가입

| 구분 | 사용자 스토리 |
|------|-------------|
| US-05 | 기관 담당자는 일반 사용자 정보 + 재직증명서 이미지를 첨부하여 가입 신청할 수 있다 |
| US-06 | 기관 담당자는 회원가입 시 `ROLE = ORGANIZATION`으로 저장되고, Organization이 `approvalStatus = PENDING`(대기) 상태로 생성된다 |
| US-07 | 기관 담당자는 미승인(`approvalStatus = PENDING`) 상태에서 로그인은 가능하나 강의 등록은 불가하다 |
| US-08 | 기관 담당자는 관리자 승인 후 `approvalStatus = APPROVED`(승인) 상태가 되어 강의 등록이 가능하다 |

#### 3.1.3 소셜 회원가입

| 구분 | 사용자 스토리 |
|------|-------------|
| US-09 | 사용자는 Google 계정으로 회원가입할 수 있다 |
| US-10 | 사용자는 GitHub 계정으로 회원가입할 수 있다 |
| US-11 | 소셜 회원가입 시 추가 정보(닉네임, 전화번호, 주소)를 입력해야 한다 |

### 3.2 로그인

#### 3.2.1 이메일 로그인

| 구분 | 사용자 스토리 |
|------|-------------|
| US-12 | 사용자는 이메일과 비밀번호로 로그인할 수 있다 |

#### 3.2.2 소셜 로그인

| 구분 | 사용자 스토리 |
|------|-------------|
| US-13 | 사용자는 Google 계정으로 로그인할 수 있다 |
| US-14 | 사용자는 GitHub 계정으로 로그인할 수 있다 |

#### 3.2.3 토큰 발급

| 구분 | 사용자 스토리 |
|------|-------------|
| US-15 | 로그인 성공 시(이메일/소셜) Access Token과 Refresh Token을 발급받는다 |

#### 3.2.4 동시 로그인 제한

| 구분 | 사용자 스토리 |
|------|-------------|
| US-16 | 사용자가 새로운 기기에서 로그인하면 기존 세션은 무효화된다 |

### 3.3 로그아웃

| 구분 | 사용자 스토리 |
|------|-------------|
| US-17 | 사용자는 로그아웃할 수 있다 |
| US-18 | 로그아웃 시 서버에서 Refresh Token이 무효화된다 |

### 3.4 토큰 갱신

| 구분 | 사용자 스토리 |
|------|-------------|
| US-19 | 사용자는 Refresh Token으로 새로운 Access Token을 발급받을 수 있다 |
| US-20 | 만료된 Refresh Token으로는 토큰을 갱신할 수 없다 |

### 3.5 비밀번호 변경/찾기

| 구분 | 사용자 스토리 |
|------|-------------|
| US-21 | 로그인한 사용자는 비밀번호를 변경할 수 있다 |
| US-22 | 사용자는 이메일로 비밀번호 재설정 링크를 받을 수 있다 |
| US-23 | 사용자는 비밀번호 재설정 링크를 통해 새 비밀번호를 설정할 수 있다 |

---

## 4. 비기능 요구사항

### 4.1 보안

| 구분 | 요구사항 |
|------|----------|
| NFR-01 | 비밀번호는 BCrypt로 암호화하여 저장한다 |
| NFR-02 | Access Token 만료 시간: 1시간 |
| NFR-03 | Refresh Token 만료 시간: 1일 |
| NFR-04 | 비밀번호 정책: 최소 8자, 특수문자 1개 이상 포함 |
| NFR-05 | 동시 로그인 불가 (단일 세션) |

### 4.2 성능

| 구분 | 요구사항 |
|------|----------|
| NFR-06 | 로그인 응답 시간 1초 이내 |
| NFR-07 | 토큰 검증 응답 시간 100ms 이내 |

---

## 5. 범위 (Scope)

### 5.1 포함 (In Scope)

- [x] 이메일 회원가입
- [x] 소셜 회원가입 (Google, GitHub)
- [x] 이메일 인증
- [x] 이메일 로그인
- [x] 소셜 로그인 (Google, GitHub)
- [x] 로그아웃
- [x] JWT 토큰 발급 및 갱신
- [x] 비밀번호 변경
- [x] 비밀번호 찾기 (이메일 재설정)
- [x] 동시 로그인 제한

### 5.2 제외 (Out of Scope)

- [ ] 관리자 회원가입 (시스템 생성)
- [ ] 기관 담당자 승인 프로세스 (별도 기능)
- [ ] 회원 탈퇴
- [ ] 2단계 인증 (2FA)
- [ ] 로그인 실패 횟수 제한

---

## 6. 데이터 요구사항

### 6.1 기존 테이블 활용

**MEMBERS 테이블**
| 컬럼 | 용도 |
|------|------|
| USER_ID | 사용자 고유 ID |
| EMAIL | 로그인 이메일 (UNIQUE) |
| PASSWORD | 암호화된 비밀번호 |
| NAME | 이름 |
| NICKNAME | 닉네임 |
| PHONE | 전화번호 |
| ROLE | USER / ORGANIZATION / ADMIN |
| ORG_ID | 소속 기관 ID (FK → ORGANIZATIONS) |
| LOCATION | 주소 |

**ORGANIZATIONS 테이블**
| 컬럼 | 용도 |
|------|------|
| ORG_ID | 기관 고유 ID |
| USER_ID | 기관 담당자 ID (FK → MEMBERS) |
| ORG_NAME | 기관명 |
| DESCRIPTION | 기관 설명 |
| APPROVAL_STATUS | 승인 상태 (0=PENDING, 1=APPROVED, 2=REJECTED) |
| CERTIFICATE_URL | 재직증명서 URL |
| GOV_AUTH | 정부 인증 정보 |
| FACILITY_IMAGE_URL | 시설 이미지 URL |
| ORG_LOGO_URL | 기관 로고 URL |

### 6.2 추가 필요 테이블

| 테이블 | 용도 |
|--------|------|
| REFRESH_TOKENS | Refresh Token 저장 및 관리 |
| EMAIL_VERIFICATIONS | 이메일 인증 토큰 관리 |
| SOCIAL_ACCOUNTS | 소셜 로그인 연동 정보 |
| PASSWORD_RESET_TOKENS | 비밀번호 재설정 토큰 |

---

## 7. 관련 문서

- [Tech Spec](./tech-spec.md)
- [Development Plan](./plan.md)
- [Implementation Report](./report.md)

---

## 8. 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 0.1 | 2025-12-05 | 초안 작성 |
|------|------|----------|
| 0.1 | 2025-12-05 | 초안 작성 |
