## 필수 정보

### 1. 참여자 (Participants/Actors)
| 참여자 | 설명 | 기술 스택 |
|--------|------|-----------|
| 사용자 (User) | 서비스 이용자 | 브라우저 |
| 프론트엔드 (Frontend) | 웹 클라이언트 | Next.js + Nginx |
| 백엔드 (Backend) | API 서버 | Spring + Spring Security |
| DB (Database) | 데이터 저장소 | PostgreSQL |

### 2. 시나리오/흐름 설명
- 비밀번호 변경 (로그인 상태)
- 임시 비밀번호 발급 (비밀번호 찾기)

> **Note**: 비밀번호 관리 기능은 일반 회원가입(이메일) 사용자만 해당됩니다.
> **Note**: OAuth 사용자는 비밀번호가 없으므로 이 기능을 사용할 수 없습니다.

### 3. 메시지 흐름 순서

#### 3-1. 비밀번호 변경 흐름 (로그인 상태)
```
1. 사용자 → 프론트엔드: 마이페이지 > 비밀번호 변경 클릭
2. 프론트엔드 → 사용자: 비밀번호 변경 폼 표시 (현재 비밀번호, 새 비밀번호)
3. 사용자 → 프론트엔드: 비밀번호 입력 후 "변경" 버튼 클릭
4. 프론트엔드: 클라이언트 유효성 검사 (8자 이상, 특수문자 포함)
5. 프론트엔드 → 백엔드: 비밀번호 변경 요청 (PATCH /api/v1/auth/password)
   - Cookie: accessToken
   - Body: { currentPassword, newPassword }
6. 백엔드: Access Token에서 userId 추출
7. 백엔드 → DB: 사용자 조회 (userId)
8. DB → 백엔드: 사용자 정보 반환
9. 백엔드: 현재 비밀번호 검증 (BCrypt.matches)
10. [조건] 현재 비밀번호 일치:
    - 백엔드: 새 비밀번호 정책 검증 (8자 이상, 특수문자)
    - 백엔드: 새 비밀번호 암호화 (BCrypt)
    - 백엔드 → DB: 비밀번호 업데이트
    - DB → 백엔드: 업데이트 완료
    - 백엔드 → 프론트엔드: 200 OK
    - 프론트엔드 → 사용자: "비밀번호가 변경되었습니다" 메시지
11. [조건] 현재 비밀번호 불일치:
    - 백엔드 → 프론트엔드: 400 Bad Request (현재 비밀번호 불일치)
    - 프론트엔드 → 사용자: 에러 메시지 표시
12. [조건] 새 비밀번호 정책 위반:
    - 백엔드 → 프론트엔드: 400 Bad Request (비밀번호 정책 위반)
    - 프론트엔드 → 사용자: 에러 메시지 표시
```

#### 3-2. 임시 비밀번호 발급 흐름 (비밀번호 찾기)
```
1. 사용자 → 프론트엔드: 로그인 페이지 > "비밀번호 찾기" 링크 클릭
2. 프론트엔드 → 사용자: 이메일 입력 폼 표시 (모달 또는 인라인)
3. 사용자 → 프론트엔드: 이메일 입력 후 "임시 비밀번호 발급" 버튼 클릭
4. 프론트엔드: 이메일 형식 유효성 검사
5. 프론트엔드 → 백엔드: 임시 비밀번호 발급 요청 (POST /api/v1/auth/password/temporary)
   - Body: { email }
6. 백엔드 → DB: 이메일로 사용자 조회
7. DB → 백엔드: 조회 결과 반환
8. [조건] 사용자 존재 + 일반 가입자 (password != null):
    - 백엔드: 임시 비밀번호 생성 (랜덤 12자리)
    - 백엔드: 임시 비밀번호 암호화 (BCrypt)
    - 백엔드 → DB: 비밀번호 업데이트
    - DB → 백엔드: 업데이트 완료
    - 백엔드: 임시 비밀번호 이메일 발송
    - 백엔드 → 프론트엔드: 200 OK { message: "임시 비밀번호가 이메일로 발송되었습니다" }
    - 프론트엔드 → 사용자: 성공 메시지 표시
9. [조건] 사용자 없음 또는 OAuth 가입자 (password == null):
    - 백엔드 → 프론트엔드: 200 OK { message: "임시 비밀번호가 이메일로 발송되었습니다" }
    - (보안: 가입 여부 노출 방지를 위해 동일 응답)
    - 프론트엔드 → 사용자: 성공 메시지 표시
10. 사용자: 이메일에서 임시 비밀번호 확인
11. 사용자 → 프론트엔드: 로그인 페이지에서 임시 비밀번호로 로그인
12. (권장) 로그인 후 마이페이지에서 비밀번호 변경
```

---

## 추가 정보

### 4. 사전 조건 (Preconditions)
| 시나리오 | 사전 조건 |
|----------|----------|
| 비밀번호 변경 | 로그인 상태 (Access Token 보유), 일반 회원가입 사용자 |
| 임시 비밀번호 발급 | 일반 회원가입 사용자 (OAuth 제외) |

### 5. 사후 조건 (Postconditions)
| 시나리오 | 사후 조건 |
|----------|----------|
| 비밀번호 변경 | 새 비밀번호로 로그인 가능 |
| 임시 비밀번호 발급 | 임시 비밀번호로 로그인 가능, 기존 비밀번호 무효화 |

### 6. 예외 처리
| 시나리오 | 예외 상황 | 응답 |
|----------|----------|------|
| 비밀번호 변경 | 현재 비밀번호 불일치 | 400 Bad Request |
| 비밀번호 변경 | 새 비밀번호 정책 위반 | 400 Bad Request |
| 비밀번호 변경 | 미로그인 상태 | 401 Unauthorized |
| 비밀번호 변경 | OAuth 사용자 | 400 Bad Request |
| 임시 비밀번호 발급 | 이메일 형식 오류 | 400 Bad Request |

### 7. API 명세

#### 7-1. 비밀번호 변경
```
PATCH /api/v1/auth/password

Request:
- Cookie: accessToken (필수)
- Body:
  {
    "currentPassword": "OldPassword1!",
    "newPassword": "NewPassword1!"
  }

Response:
- 200 OK
- 400 Bad Request (현재 비밀번호 불일치, 정책 위반)
- 401 Unauthorized (미로그인)
```

#### 7-2. 임시 비밀번호 발급
```
POST /api/v1/auth/password/temporary

Request:
- Body:
  {
    "email": "user@example.com"
  }

Response:
- 200 OK
  {
    "message": "임시 비밀번호가 이메일로 발송되었습니다"
  }
```

### 8. 비밀번호 정책
| 규칙 | 설명 |
|------|------|
| 최소 길이 | 8자 이상 |
| 특수문자 | 1개 이상 포함 (`!@#$%^&*(),.?":{}|<>`) |

### 9. 임시 비밀번호 생성 규칙
| 항목 | 값 |
|------|-----|
| 길이 | 12자 |
| 구성 | 영문 대소문자 + 숫자 + 특수문자 |
| 예시 | `Temp1234!@ab` |

### 10. 이메일 템플릿

#### 임시 비밀번호 발급 메일
```
제목: [SW Campus] 임시 비밀번호 안내

내용:
안녕하세요, SW Campus입니다.

요청하신 임시 비밀번호를 안내해드립니다.

임시 비밀번호: {temporaryPassword}

보안을 위해 로그인 후 반드시 비밀번호를 변경해주세요.
본인이 요청하지 않은 경우 이 메일을 무시해주세요.

감사합니다.
SW Campus 팀
```
